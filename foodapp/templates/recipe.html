{% extends "base.html" %}
  
  {% block TITLE %}
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js" ></script>
  <title>Home</title>
  <script>
    $(document).ready(function(){
      $('#searchbox_rec').keyup(function(){
        req = $.ajax({
          data : { dish : $('#searchbox_rec').val() },
          type : 'POST', 
          url : '/dish' 
        }); 

        req.done(function (data){
          $('#cont_rec').html('');
          for (var i=0; i<data['result'].length; i++){
            $('#cont_rec').append('<button>' + data['result'][i] + '</button>' );
          }
        });
      });    
    });
  </script>
  
  <link rel="stylesheet" href="{{ url_for('static', filename='css/searchbox.css') }}">
  <script>
    var ingredients_list = [];

    function recipeFilter(){
        $('#filterlist').html('');
        for(var j=0; j<ingredients_list.length; j++){
            $('#filterlist').append('<span class="card bg-primary"><div class="card-body text-center">' + ingredients_list[j] + ' <a name="' + ingredients_list[j] + '" onclick="removeIngredient(this)">X</a></div></span>');
        }

        requ = $.post( "{{ url_for('filteredrecipe') }}", { 'info[]': ingredients_list } );

        requ.done(function (data){
            console.log(data.result);
            $('#recipe_list').html(data.result);
        });
    }

    function removeIngredient(ele){
      var ind = ingredients_list.indexOf(ele.name);
      ingredients_list.splice(ind,1);
      recipeFilter();
    }
    

    $(document).ready(function(){
        $('#searchbox_ing').keyup(function(){
          req = $.ajax({
            data : { 'search' : $('#searchbox_ing').val() },
            type : 'POST',
            url : '{{ url_for('ingredientsearch') }}'
          });
            
          req.done(function (data){
            $('#cont_ing').html('');
            for (var i=0; i<data['result'].length; i++){
              var btn = document.createElement("BUTTON");
              btn.innerHTML = data['result'][i];
              
              btn.addEventListener('click', function() {
                  if(!ingredients_list.includes(this.innerHTML)){
                    ingredients_list.push(this.innerHTML);
                    console.log(ingredients_list);

                    $('#filterlist').html('');
                    for(var j=0; j<ingredients_list.length; j++){
                      $('#filterlist').append('<span class="card bg-primary"><div class="card-body text-center">' + ingredients_list[j] + ' <a name="' + ingredients_list[j] + '" onclick="removeIngredient(this)">X</a></div></span>');
                    }
                    recipeFilter();
                  }
              });

              document.getElementById('cont_ing').appendChild(btn);
            }
          });
        });    
      });
  </script>

  {% endblock %}

  {% block content%}
  <br>

  <div class="dropdown">
    <input class="dropbtn" id="searchbox_ing" placeholder="Search">
    <div class="dropdown-content" id="cont_ing">
        
    </div>
  </div>

  <div id="filterlist" class="row">

  </div>

  <br><br>
  <div id="recipe_list" class="card-columns">
  
  </div>
  {% endblock %}
